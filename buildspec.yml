version: 0.2
env:
  secrets-manager:
    SECRET_KEY: "codepipeline:SECRET_KEY"
    NEW_ACCESS_KEY: "codepipeline:NEW_ACCESS_KEY"
    ACCESS_KEY: "codepipeline:ACCESS_KEY"
    NEW_SECRET_KEY: "codepipeline:NEW_SECRET_KEY"
    AOA_ACCESS_KEY: "codepipeline:AOA_ACCESS_KEY"
    AOA_SECRET_KEY: "codepipeline:AOA_SECRET_KEY"
    5762_ACCESS_KEY: "codepipeline:5762_ACCESS_KEY"
    5762_SECRET_KEY: "codepipeline:5762_SECRET_KEY"

phases:
  install:
    runtime-versions:
      nodejs: 18
  pre_build:
    commands:
      - cd blin
      - echo install process started
      - npm install && npm install -g @angular/cli

  build:
    commands:
       - echo testing...
       - ng build --configuration production --build-optimizer --aot
       - ls
       - pwd
       - ls
       - pwd
       
  post_build:
    commands:
       - aws configure set aws_access_key_id $5762_ACCESS_KEY
       - aws configure set aws_secret_access_key $5762_SECRET_KEY
       - aws s3 sync dist/ s3://buildtwin-multitenant-dev/ --region ap-south-1 --acl public-read
